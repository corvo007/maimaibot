# 设计文档

每首歌的每个难度的统计数据有：
数据数量
定数（机上显示）
（精确定数可查询基本信息得到）
拟合难度
与同定数的歌曲比较：
    平均达成率/平均DX分数
    达成率分布（S/SS/SS+/...）
    完成情况分布（FC/FC+/AP/AP+）
达成率标准差

歌曲基本信息：
note数/谱师/艺术家/bpm/更新版本/流派/曲名/新老定数/类型（标准谱orDX谱）

三个tab：
统计数据
推分谱面推荐
成绩表格

无需登录：
1.0 显示每个难度的统计数据

1.0 显示当前版本定数与上一版本的差异，并展示差距最大的10首歌（按难度展示（下拉框切换难度））
1.0 统计出最受欢迎歌曲10首（带或不带难度）（可以按难度、流派、版本、类型筛选）
1.0 统计出最粪/最好嫖分（虚标难度）歌曲（拟合难度与定数差距最大的10首歌）（按难度展示（下拉框切换难度））
1.0 统计出个人差最大的歌曲（标准差最大的10首）（可以按难度、流派、版本、类型筛选）

需要输入绑定的QQ或用户名（通过开发者通道查询）：
1.0 根据玩家的成绩推荐推分歌曲
        目标是刷新玩家的b35/b15，因此可以选择拟合难度低于定数的，且至少S之后rating高于b35/b15最后一位的
        从拟合难度与定数差距最大的开始推荐
        玩家可以选择推荐偏好：保守/适中/激进（保守就只推荐SSS/SSS+各5首，适中就只推荐SS/SS+各5首，激进推荐S/S+各5首，默认偏好适中）
        玩家可以选择优先推荐没玩过的歌或者不设置
        可以 加入歌曲到黑名单中（“不推荐此歌曲”），并标注原因（不喜欢曲师、不喜欢谱师、不喜欢谱面、不会配置、手癖、未解锁）
        可以 点赞/点踩歌曲
        如果推荐的歌曲有成绩，则显示与现在的成绩相比能提升的达成率/rating
        如果没有成绩，则与最后一位相比显示能提升的rating

2.0 展示玩家rating进步情况
2.0 显示每曲的成绩-评分曲线（或者进步情况）

技术栈：
    后端：Python/fastapi/sqlite
    前端：Vue（前端只负责展示和排序，部分筛选也由前端执行）

https://www.diving-fish.com/covers/00627.png # 封面图片，最后是id

id:标准谱4位，DX谱5位

```json5
{
	"basic_info": {
		"artist": "れるりり",
		"bpm": 155,
		"from": "maimai でらっくす",
		"genre": "niconico \u0026 VOCALOID",
		"image_url": "968dbd5f0c309827.png",
		"is_new": false,
		"title": "脳漿炸裂ガール",
		"version": "12000"
	},
	"charts": [{
		"charter": "-",
		"notes": [116, 0, 4, 15, 2] 
        // tap hold slide touch break
      // 如果是标准谱那就只有4个数据，没有touch
	}, {
		"charter": "-",
		"notes": [220, 19, 5, 8, 4]
	}, {
		"charter": "Jack",
		"notes": [303, 33, 51, 23, 18]
	}, {
		"charter": "はっぴー",
		"notes": [455, 47, 50, 110, 3]
	}],
	"ds": [4.0, 6.0, 11.3, 12.9],
	"id": "10145",
	"level": ["4", "6", "11", "12+"],
	"old_ds": [4.0, 6.3, 11.7, 13.9],
	"title": "脳漿炸裂ガール",
	"type": "DX"
}
```

```json5
{
  "charts":
  {"1": // 歌曲id
  [
    {}, // 每个难度的统计数据，详细见下
    {}
  ]
  },
  "diff_data":
  {"1":{ // 难度
    "achievements": 97.24145680992692, // 平均达成率
    "dist": [ 
      // 达成率等级分布
      // D C B BB BBB A AA AAA S S+ SS SS+ SSS SSS+
        0.024667070217917676,
        0.007263922518159807,
        0.009079903147699757,
        0.005901937046004843,
        0.008777239709443099,
        0.020732445520581115,
        0.011652542372881356,
        0.013771186440677966,
        0.007717917675544794,
        0.016343825665859565,
        0.018159806295399514,
        0.01740314769975787,
        0.0661319612590799,
        0.7723970944309927
    ],
    "fc_dist": [
      // 完成状态分布
      // Not FC FC FC+ AP AP+
        0.11682808716707022,
        0.03631961259079903,
        0.17584745762711865,
        0.2298728813559322,
        0.4411319612590799
    ]
}
  }
}
```

```json5
{
    "cnt": 565, // 数据量
    "diff": "5", // 定数
    "fit_diff": 5.03328596480223, // 拟合难度
    "avg": 100.25378442477874, // 平均达成率
    "avg_dx": 260.5557522123894, // 平均DX分数
    "std_dev": 0.8533989352735014, // 标准差
    "dist": [ // 达成率等级分布
        0,
        1,
        0,
        1,
        1,
        10,
        5,
        3,
        3,
        5,
        3,
        6,
        30,
        497
    ],
    "fc_dist": [ // 完成状态分布
        27,
        15,
        85,
        153,
        285
    ]
}
```

```json5
{
    "achievements": 92.4975, // 达成率
    "ds": 4, // 精确定数
    "dxScore": 318, // DX分数
    "fc": "fc", // FC徽标 空 fc fcp ap app
    "fs": "fsp", // FS徽标 空 fs fsp fsd fsdp
    "level": "4", // 显示定数 
    "level_index": 0, // 难度
    "level_label": "Basic", // 难度描述
    "ra": 56, // 单曲rating
    "rate": "aa", // 单曲评级
    "song_id": 486, // 歌曲id
    "title": "前前前世", // 标题
    "type": "SD" // 类型
}
```